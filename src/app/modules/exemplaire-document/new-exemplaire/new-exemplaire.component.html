<div class="mainBlock" id="top2">
     <form [formGroup]="formeExemplaire" (ngSubmit)="onSubmit(formeExemplaire)" *ngIf="formeExemplaire" >
        <h1>
            {{this.document.titre}} {{titre}}
        </h1>
        <div class="infos">
            <p id="titre">
                {{'document.exemplaire.text9' | translate}} :
                <span class="title">{{this.nomPatientCourant}}</span>
            </p>
            <p id="titre">
                {{'document.exemplaire.text6' | translate}} :
                <span class="title">{{this.exemplaire.dateCreation | date: 'dd/MM/yyyy'}}</span>
                {{'document.exemplaire.text7' | translate}} 
                <span class="title">{{this.exemplaire.dateCreation | date: 'hh:mm:ss'}}</span>
            </p>
            <div  *ngIf="submitted && estValide == false" class="alert alert-danger">
                <div >{{eValvalide}} {{'lists.text3' | translate}}</div>
            </div>
            <div class="block1" *ngFor="let attributParCategorie of document.categories">
                <div class="pb-3" *ngIf="attributParCategorie.nom">
                    <h3>{{attributParCategorie.nom}}</h3>
                    <div class="contentBlock">
                        <div formArrayName="_exemplaireDocument" class="inputBlock" *ngFor="let attributParCategorie of attributParCategorie.listAttributsParCategories; let i = index" [ngClass]="{'inputSpecial':(attribut.type == TypeRadio) || (attribut.type == TypeBoolean)}">
                            <label [for]="attributParCategorie.attribut.id" class="form-label">{{attributParCategorie.attribut.titre}}<span *ngIf="attributParCategorie.obligatoire == true"> *</span></label>
                            <input  *ngIf="(attributParCategorie.attribut.type != typeTextArea) && (attributParCategorie.attribut.type != TypeRadio) && (attributParCategorie.attribut.type != TypeBoolean)" [formControlName]="incrementeCompteur(compteur,attributParCategorie)" [type]="attributParCategorie.attribut.type" class="form-control" placeholder="{{'lists.text4' | translate}}">
                            <textarea *ngIf="attributParCategorie.attribut.type == typeTextArea" class="form-control"  [formControlName]="incrementeCompteur(compteur,attributParCategorie)" placeholder="{{'lists.text4' | translate}}"></textarea>
                            <select class="form-control" *ngIf="(attributParCategorie.attribut.type == TypeRadio) || (attributParCategorie.attribut.type == TypeBoolean)" [formControlName]="incrementeCompteur(compteur,attributParCategorie)">
                                <option value="{{val.trim()}}" *ngFor="let val of attributParCategorie.attribut.valeursParDefaut.trim().split(',')" >{{val}}</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="block1 card" id="controlsSupprimeBlock" *ngIf="objetCleValeurSupprime.length != 0">
                <h3>{{'document.exemplaire.title2' | translate}} <i class="fa fa-exclamation-triangle"></i></h3>
                <div class="d-flex" id="controlsSupprime">
                    <div formArrayName="_controlsSupprime" *ngFor="let attributSupprime of objetCleValeurSupprime" class="inputBlock" [ngClass]="{'inputSpecial':(attributSupprime.key.type == TypeRadio) || (attributSupprime.key.type == TypeBoolean)}">
                        <label class="form-label">{{attributSupprime.key.titre}}</label>

                        <input *ngIf="(attributSupprime.key.type != typeTextArea) && (attributSupprime.key.type != TypeRadio) && (attributSupprime.key.type != TypeBoolean)" [formControlName]="incrementeNumerateur(numerateur,attributSupprime.key)" [type]="attributSupprime.key.type" class="form-control" placeholder="{{'lists.text4' | translate}}" [required]="true">
                        <textarea *ngIf="attributSupprime.key.type == typeTextArea" class="form-control"  [formControlName]="incrementeNumerateur(numerateur,attributSupprime.key)" placeholder="{{'lists.text4' | translate}}"></textarea>
                        <select class="form-control" *ngIf="(attributSupprime.key.type == TypeRadio) || (attributSupprime.key.type == TypeBoolean)" [formControlName]="incrementeNumerateur(numerateur,attributSupprime.key)">
                            <option value="{{val.trim()}}" *ngFor="let val of attributSupprime.key.valeursParDefaut.trim().split(',')" >{{val}}</option>
                        </select>
                    </div>
                </div>
            </div>
            <div *ngIf="document.contientRessources == true" class="block2 card mt-2 pt-1" id="sectionAjoutPreco">
                <div>
                    <h3>{{'document.exemplaire.title3' | translate}} :</h3>
                    <div class="searchBlock" [ngClass]="{'searchBlock': document.contientDistributeurs, 'searchBlockUnique': !document.contientDistributeurs}">
                        <div *ngIf="document.contientDistributeurs == true" class="blockAutoDistributeurs">
                            <form class="example-form-entete">
                                <h4>{{'preconisation.table.title6' | translate}}</h4>
                                <input type="text" matInput [formControl]="distributeurControl" [matAutocomplete]="autoDistributeur">
                                <mat-autocomplete class="blockAutocomplate" #autoDistributeur="matAutocomplete" [displayWith]="displayDistributeurFn">
                                    <mat-option class="options" *ngFor="let optionDistributeur of filteredDistributeurOptions" [value]="optionDistributeur" (click)="associerDistributeur(optionDistributeur)">
                                        {{optionDistributeur.raisonSocial}}
                                    </mat-option>
                                </mat-autocomplete>
                                <button *ngIf="modificationDistributeurActive == true" class="btn btnModifierDistributeurBlock" type="button" (click)="modifierDistributeur()">{{'lists.button6' | translate}}</button>
                                
                            </form>
                        </div>
                        <div class="blockAutoRessources">
                            <form class="example-form-entete">
                                <h4>{{'ressource.form.text16' | translate}}</h4>
                                <input type="text" matInput [formControl]="ressourceControl" [(ngModel)]="scan_val" [value]="scan_val" [matAutocomplete]="auto">
                                <mat-autocomplete class="blockAutocomplate" #auto="matAutocomplete" [displayWith]="displayFn">
                                    <mat-option class="options" *ngFor="let option of filteredOptionsRessource" [value]="option" (click)="rechercherListingRessources(option); verifySomme(); reinitialliseRessourceControl()">
                                        {{option.libelle}}
                                    </mat-option>
                                </mat-autocomplete>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- tableau listing des mouvements -->

                <div class="card-body p-0 tableBlock" id="tableBlock">
                    <div class='table-responsive w-100'>
                        <table class='table table-sm table-centered table-striped table-bordered w-100' mat-table [dataSource]="dataSourceMouvements">

                            <!-- libelle Column -->
                            <ng-container matColumnDef="libelle">
                                <th class="text-dark containHead" mat-header-cell *matHeaderCellDef> {{'preconisation.table.title1' | translate}} </th>
                                <td class="text-dark containCell" mat-cell *matCellDef="let element"> {{element.ressource.libelle}} </td>
                            </ng-container>

                            <!-- quantite Column -->
                            <ng-container matColumnDef="quantite">
                                <th class="text-dark containHead" mat-header-cell *matHeaderCellDef> {{'ressource.table2.title5' | translate}} </th>
                                <td class="text-dark containCell" mat-cell *matCellDef="let element; let i = index">
                                  <label class="custom-control">
                                      <input class="form-control" type="number" [(ngModel)]="element.quantite" [ngModelOptions]="{standalone: true}" [disabled]="element.typeMouvement != 'Neutre' && i <= (tailleFirstMvts - 1)" value="true">
                                  </label>
                                </td>
                          </ng-container>

                          <!-- unite Column -->
                          <ng-container matColumnDef="unite">
                                <th class="text-dark containHead" mat-header-cell *matHeaderCellDef> {{'ressource.table.title4' | translate}} </th>
                                <td class="text-dark containCell" mat-cell *matCellDef="let element">
                                  {{element.ressource.unite}}
                          </ng-container>

                            <!-- description Column -->
                            <ng-container matColumnDef="description">
                                <th class="text-dark containHead" mat-header-cell *matHeaderCellDef> {{'attributs.table.title2' | translate}} </th>
                                <td class="text-dark containCell" mat-cell *matCellDef="let element">
                                    <label class="custom-control">
                                        <input class="form-control" type="text" [(ngModel)]="element.description" [ngModelOptions]="{standalone: true}" value="true">
                                    </label>
                                </td>
                            </ng-container>

                            <!-- prix Column -->
                            <ng-container *ngIf="document.affichagePrix == true && document.typeMouvement == typeNeutre" matColumnDef="prix">
                                <th class="text-dark containHead" mat-header-cell *matHeaderCellDef> {{'ressource.table2.title7' | translate}} </th>
                                <td class="text-dark containCell" mat-cell *matCellDef="let element; let i = index">
                                    <label class="custom-control">
                                        <input class="form-control" type="number" [disabled]="element.typeMouvement != 'Neutre' && i <= (tailleFirstMvts - 1)" [(ngModel)]="element.prix" [ngModelOptions]="{standalone: true}">
                                    </label> 
                                </td>
                            </ng-container>

                            <!-- prixEntrée Column -->
                            <ng-container *ngIf="document.affichagePrix == true && document.typeMouvement == typeAjout" matColumnDef="prixEntrée">
                                <th class="text-dark containHead" mat-header-cell *matHeaderCellDef> {{'ressource.table.title5' | translate}} </th>
                                <td class="text-dark containCell" mat-cell *matCellDef="let element">
                                    <label class="custom-control">
                                        <input class="form-control" type="number" [(ngModel)]="element.prix" [ngModelOptions]="{standalone: true}">
                                    </label> 
                                </td>
                            </ng-container>

                            <!-- prixDeSortie Column -->
                            <ng-container *ngIf="document.affichagePrix == true && document.typeMouvement == typeReduire" matColumnDef="prixDeSortie">
                                <th class="text-dark containHead" mat-header-cell *matHeaderCellDef> {{'ressource.table.title9' | translate}} </th>
                                <td class="text-dark containCell" mat-cell *matCellDef="let element; let i = index">
                                    <label class="custom-control">
                                        <input class="form-control" type="number" [disabled]="element.typeMouvement != 'Neutre' && i <= (tailleFirstMvts - 1)" [(ngModel)]="element.prix" [ngModelOptions]="{standalone: true}">
                                    </label> 
                                </td>
                            </ng-container>

                            <!-- montant total Column -->
                            <ng-container *ngIf="document.affichagePrix == true" matColumnDef="montant total">
                                  <th class="text-dark containHead" mat-header-cell *matHeaderCellDef> {{'ressource.table2.title10' | translate}}</th>
                                  <td class="text-dark containCell" mat-cell *matCellDef="let element"><input type="number" value="{{element.quantite*element.prix}}" disabled> </td>
                            </ng-container>

                          <!-- distributeur Column -->
                          <ng-container *ngIf="document.contientDistributeurs == true" matColumnDef="distributeur">
                                <th class="text-dark containHead" mat-header-cell *matHeaderCellDef> {{'preconisation.table.title5' | translate}} </th>
                                <td class="text-dark containCell" mat-cell *matCellDef="let element; let i = index"><div class="modifierDistributeurBlock">{{element.distributeur?.raisonSocial}}<span role="button" title="{{'document.exemplaire.text3' | translate}}" (click)="InitialiseDistributeurControlPourModufication(i)"><i class="fa fa-pen-alt text-warning" aria-hidden="true"></i></span></div></td>
                        </ng-container>

                            <!-- Actions column -->
                            <ng-container matColumnDef="actions">
                                <th class="text-dark containHead" mat-header-cell *matHeaderCellDef> {{"patient.table.title8" | translate}} </th>
                                <td class="text-dark containCell" mat-cell *matCellDef="let element; let i = index">
                                    <div class="actions">
                                        <button class="btn p-0" [disabled]="element.typeMouvement != 'Neutre' && i <= (tailleFirstMvts - 1)" [value]="element.id" title="clicker pour annuler la selection" (click)="retirerSelectionRessource(i)">
                                            <i class="fa fa-trash text-danger" aria-hidden="true"></i>
                                        </button>
                                        <span><i class="fa fa-info-circle text-info ml-1" (click)="getRessourceId(element.id)" aria-hidden="true" title="{{'preconisation.table.title4' | translate}}"></i></span>
                                    </div>
                                </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="displayedRessourcesColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedRessourcesColumns;"></tr>
                        </table>

                        <!-- montant total -->
                        <div class="total" *ngIf="document.affichagePrix == true && ELEMENTS_TABLE_MOUVEMENTS.length > 0">
                            <span class="mr-2">{{'ressource.table2.title11' | translate}}</span>
                            <input type="text" [value]="sommeMontants()" disabled>
                        </div>

                        <mat-paginator [pageSizeOptions]="[2, 5, 10, 20]"
                                       showFirstLastButtons
                                       aria-label="Select page of periodic elements">
                        </mat-paginator>
                    </div>
                </div>

                <!-- tableau de mouvement d'une caisse -->
                <div class="card-body">
                        <div class="w-50">
                            <h2>{{'lists.text5' | translate}}</h2>

                            <div class="d-flex flex-wrap justify-content-between block1 p-2">
                                <div class="form-group">
                                    <div class="champs">
                                        <label for="exemplaire" class="label">
                                            {{'mvtCaisse.table.title7' | translate}}
                                        </label>
                                        <div class="d-flex" >
                                            <input type="text" [value]="compte?.solde" disabled class="form-control" style="color: black;">
                                            <input style="margin-left: 0.375rem;" type="checkbox" name="use" formControlName="use" (change)="useSolde(fCaisse['use'].value)" title="{{'lists.text6' | translate }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div>
                                        <div class="champs">
                                            <label for="montant" class="label">
                                                {{'mvtCaisse.table.title0' | translate}}
                                            </label>
                                            <div>
                                                <input type="number" formControlName="montant" name="montant" [disabled]="fCaisse['use'].value" class="form-control">
                                            </div>
                                        </div>
                                        <div *ngIf="submitted && fCaisse['montant'].errors"  class="alert alert-danger" >
                                            <div *ngIf="fCaisse['montant'].errors['required']">{{'mvtCaisse.form.text1' | translate}}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div>
                                        <div class="champs">
                                            <label for="reste" class="label">
                                                {{'mvtCaisse.table.title8' | translate}}
                                            </label>
                                            <div>
                                                <input type="number" [value]="resteAPayer" (change)="resteAPayer" disabled class="form-control">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                        <div class="champs">
                                            <label for="moyenPaiement" class="label">
                                                {{'mvtCaisse.table.title2' | translate}}
                                            </label>
                                            <select formControlName="moyenPaiement" name="moyenPaiement" (change)="verifyUseSolde()" class="form-control">
                                                <option *ngFor="let caisse of caisses" [value]="caisse.type">{{caisse.type}}</option>
                                                <option value="multipaiement">Multipaiement</option>
                                            </select>
                                        </div>
                                        <div *ngIf="submitted && fCaisse['moyenPaiement'].errors"  class="alert alert-danger" >
                                            <div *ngIf="fCaisse['moyenPaiement'].errors['required']">{{'mvtCaisse.form.text3' | translate}}</div>
                                        </div>
                                </div>
                                <div *ngIf="fCaisse['moyenPaiement'].value == 'cash'" class="form-group overflow-auto">
                                    <div class="champs">
                                        <div class="table-responsive">
                                            <table class="table table-centered table-bordered w-100">
                                                <thead>
                                                  <tr>
                                                    <th scope="col">x1</th>
                                                    <th scope="col">x2</th>
                                                    <th scope="col">x5</th>
                                                    <th scope="col">x10</th>
                                                    <th scope="col">x25</th>
                                                    <th scope="col">x50</th>
                                                    <th scope="col">x100</th>
                                                    <th scope="col">x500</th>
                                                    <th scope="col">x500 {{ 'mvtCaisse.table.title9' | translate }}</th>
                                                    <th scope="col">x1000</th>
                                                    <th scope="col">x2000</th>
                                                    <th scope="col">x5000</th>
                                                    <th scope="col">x10000</th>
                                                  </tr>
                                                </thead>
                                                <tbody>
                                                  <tr class="w-100">
                                                    <td><input placeholder="{{'mvtCaisse.table.title10' | translate}}" formControlName="x1" type="number" class="form-control w-auto"></td>
                                                    <td><input placeholder="{{'mvtCaisse.table.title10' | translate}}" formControlName="x2" type="number" class="form-control w-auto"></td>
                                                    <td><input placeholder="{{'mvtCaisse.table.title10' | translate}}" formControlName="x5" type="number" class="form-control w-auto"></td>
                                                    <td><input placeholder="{{'mvtCaisse.table.title10' | translate}}" formControlName="x10" type="number" class="form-control w-auto"></td>
                                                    <td><input placeholder="{{'mvtCaisse.table.title10' | translate}}" formControlName="x25" type="number" class="form-control w-auto"></td>
                                                    <td><input placeholder="{{'mvtCaisse.table.title10' | translate}}" formControlName="x50" type="number" class="form-control w-auto"></td>
                                                    <td><input placeholder="{{'mvtCaisse.table.title10' | translate}}" formControlName="x100" type="number" class="form-control w-auto"></td>
                                                    <td><input placeholder="{{'mvtCaisse.table.title10' | translate}}" formControlName="x500" type="number" class="form-control w-auto"></td>
                                                    <td><input placeholder="{{'mvtCaisse.table.title10' | translate}}" formControlName="x500B" type="number" class="form-control w-auto"></td>
                                                    <td><input placeholder="{{'mvtCaisse.table.title10' | translate}}" formControlName="x1000" type="number" class="form-control w-auto"></td>
                                                    <td><input placeholder="{{'mvtCaisse.table.title10' | translate}}" formControlName="x2000" type="number" class="form-control w-auto"></td>
                                                    <td><input placeholder="{{'mvtCaisse.table.title10' | translate}}" formControlName="x5000" type="number" class="form-control w-auto"></td>
                                                    <td><input placeholder="{{'mvtCaisse.table.title10' | translate}}" formControlName="x10000" type="number" class="form-control w-auto"></td>
                                                  </tr>
                                                </tbody>
                                              </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div>
                                        <div class="champs">
                                            <label for="referencePaiement" class="label">
                                                {{'mvtCaisse.table.title4' | translate}}
                                            </label>
                                            <input type="text" formControlName="referencePaiement" name="referencePaiement" class="form-control">
                                        </div>
                                        <div *ngIf="submitted && fCaisse['referencePaiement'].errors"  class="alert alert-danger" >
                                            <div *ngIf="fCaisse['referencePaiement'].errors['required']">{{'mvtCaisse.form.text4' | translate}}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>
            </div>
        </div>
        
        <div class="actionButton valBtn">
            <button class="btn retour" type="reset" routerLink="../../executer-missions" title="{{'lists.button2' | translate}}">
                <i class="fa fa-undo" aria-hidden="true"></i>
            </button>
            <div *ngIf="document.contientRessources == true"><app-modal-codebarre-scan-continue></app-modal-codebarre-scan-continue></div>      
            
            <button type="submit" class="btn btnValidation" title="{{btnLibelle}}">
                <i class="fa fa-check" aria-hidden="true"></i>
            </button>
        </div>
    </form>
</div>
